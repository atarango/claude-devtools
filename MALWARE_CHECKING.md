# Malware & Security Verification Guide

This guide explains how to verify the security and integrity of this repository, detect potential malware, and audit the codebase for vulnerabilities.

## Quick Start

```bash
# Install dependencies
pnpm install

# Run automated security test suite
pnpm run security:test

# Run all security checks (includes audit, lint, typecheck)
pnpm run security:check

# Check for dependency vulnerabilities
pnpm audit

# Scan code for security issues
pnpm lint
```

---

## Table of Contents

1. [Overview](#overview)
2. [Pre-Installation Verification](#pre-installation-verification)
3. [Dependency Scanning](#dependency-scanning)
4. [Code Security Analysis](#code-security-analysis)
5. [Build Verification](#build-verification)
6. [Runtime Monitoring](#runtime-monitoring)
7. [Automated Security Checks](#automated-security-checks)
8. [Manual Code Audit](#manual-code-audit)
9. [Network Monitoring](#network-monitoring)
10. [Additional Resources](#additional-resources)

---

## Overview

**claude-devtools** is designed with security and privacy as core principles:

- ✅ **Zero telemetry** — No data leaves your machine
- ✅ **Open source** — Every line of code is publicly auditable
- ✅ **Security-focused linting** — Uses `eslint-plugin-security` and `eslint-plugin-sonarjs`
- ✅ **Strict TypeScript** — Type safety reduces entire classes of bugs
- ✅ **Code signing** — macOS binaries are notarized, Windows builds are signed
- ✅ **CI/CD validation** — Every commit is tested on multiple platforms

See [SECURITY.md](./SECURITY.md) for our security policy.

---

## Pre-Installation Verification

### 1. Verify Repository Authenticity

Ensure you're downloading from the official repository:

```bash
# Official repository
git clone https://github.com/matt1398/claude-devtools.git
cd claude-devtools

# Check remote origin
git remote -v
# Should show: https://github.com/matt1398/claude-devtools.git
```

### 2. Verify Release Signatures (Binary Downloads)

For pre-built binaries from GitHub Releases:

**macOS:**
```bash
# Check code signing (after download)
codesign -dv --verbose=4 /Applications/claude-devtools.app

# Verify notarization
spctl -a -vvv -t install /Applications/claude-devtools.app
```

**Windows:**
```powershell
# Check digital signature
Get-AuthenticodeSignature "claude-devtools Setup.exe"
```

**Linux:**
```bash
# Verify AppImage integrity with SHA256
sha256sum claude-devtools-*.AppImage

# Compare against the SHA256 checksum published in the GitHub release notes
# Example: b5bb9d8014a0f9b1d61e21e796d78dccdf1352f23cd32812f4850b878ae4944c
```

> **Note**: Official release checksums are published in the [GitHub Releases](https://github.com/matt1398/claude-devtools/releases) page. Compare the output of `sha256sum` against the published hash.

### 3. Check Commit Signatures

```bash
# View commit history with signature verification
git log --show-signature -10

# Verify a specific commit
git verify-commit <commit-hash>
```

---

## Dependency Scanning

### 1. NPM Audit

Scan all dependencies for known vulnerabilities:

```bash
# Full audit
pnpm audit

# Detailed JSON report
pnpm audit --json > audit-report.json

# Fix automatically (use with caution)
pnpm audit --fix
```

**Interpreting Results:**
- **Critical/High** — Address immediately
- **Moderate** — Evaluate impact and update when possible
- **Low** — Monitor for updates
- **Info** — Review but usually safe to ignore

### 2. GitHub Security Advisories

Check for Dependabot alerts:

1. Go to: `https://github.com/matt1398/claude-devtools/security/dependabot`
2. Review open advisories
3. Check if updates are available

### 3. Outdated Dependencies

```bash
# Check for outdated packages
pnpm outdated

# Update to latest safe versions
pnpm update

# Update to latest (including major versions)
pnpm update --latest
```

### 4. License Compliance

```bash
# Check dependency licenses (requires global install)
npx license-checker --summary
```

---

## Code Security Analysis

### 1. ESLint Security Plugin

The project uses **eslint-plugin-security** to detect dangerous patterns:

```bash
# Run all linting (includes security checks)
pnpm lint

# Fix auto-fixable issues
pnpm lint:fix
```

**What it checks:**
- `eval()` usage and code injection risks
- Unsafe regular expressions (ReDoS attacks)
- Insecure random number generation
- Path traversal vulnerabilities
- Command injection risks
- Unsafe object access patterns

### 2. SonarJS Quality Checks

**eslint-plugin-sonarjs** catches bugs and code smells:

```bash
pnpm lint
```

**What it detects:**
- Cognitive complexity issues
- Duplicate code blocks
- Unused variables and functions
- Potential null pointer errors
- Code quality violations

### 3. TypeScript Strict Mode

```bash
# Type check everything
pnpm typecheck
```

Type safety prevents:
- Undefined/null reference errors
- Type coercion bugs
- Missing property access
- Function signature mismatches

### 4. Unused Code Detection

```bash
# Detect unused exports, files, and dependencies
pnpm run quality
# (includes: npx knip)
```

---

## Build Verification

### 1. Clean Build from Source

```bash
# Remove all generated files
rm -rf dist dist-electron node_modules

# Fresh install
pnpm install

# Build (this runs type checking and linting)
pnpm build
```

### 2. Verify Build Output

```bash
# Check build artifacts
ls -lh dist-electron/
ls -lh out/

# Search for suspicious patterns in built code
grep -r "eval(" dist-electron/
grep -r "Function(" dist-electron/
grep -r "child_process" dist-electron/
```

### 3. Diff Against Official Release

If you downloaded a binary, compare it against your own build:

```bash
# Build your own
pnpm build

# Compare file sizes, structure
ls -lh dist-electron/main/
# Should match official build structure
```

---

## Runtime Monitoring

### 1. Network Activity Monitoring

**macOS:**
```bash
# Monitor network connections (run app, then check)
lsof -i -P | grep -i claude

# Use Little Snitch or LuLu for detailed monitoring
```

**Linux:**
```bash
# Monitor network connections
sudo netstat -tunapl | grep claude

# Use Wireshark or tcpdump
sudo tcpdump -i any host 127.0.0.1 port 3456
```

**Windows:**
```powershell
# Monitor network connections
netstat -ano | findstr "claude"

# Use Wireshark or Process Monitor
```

**Expected Network Activity** (see [SECURITY.md](./SECURITY.md)):
- GitHub Releases API (auto-updater, Electron mode only)
- SSH connections (if manually configured)
- HTTP server on `127.0.0.1:3456` (when enabled)
- **NO other external connections**

### 2. File System Monitoring

**macOS:**
```bash
# Monitor file access with fs_usage
sudo fs_usage | grep claude-devtools

# Check what files are opened
lsof -c claude-devtools
```

**Linux:**
```bash
# Monitor with inotify
inotifywait -m -r ~/.claude/

# Audit with auditd
sudo auditctl -w ~/.claude/ -p rwa
```

**Windows:**
```powershell
# Use Process Monitor (procmon.exe)
# Filter by process name: claude-devtools.exe
```

**Expected File Access:**
- Read from `~/.claude/projects/**/*.jsonl` (session files)
- Read from `~/.claude/todos/**/*.json` (todo data)
- Write to `~/.claude/claude-devtools-config.json` (settings)
- **NO writes to session files** (read-only by design)
- **NO access to credential files** (blocked by IPC validation)

### 3. Process Monitoring

```bash
# macOS/Linux
ps aux | grep claude
top -p $(pgrep -f claude)

# Check what processes are spawned
pstree -p $(pgrep -f claude)
```

**Expected processes:**
- Main Electron process
- Renderer process (UI)
- GPU process (if hardware acceleration enabled)
- **NO unexpected child processes**

---

## Automated Security Checks

### GitHub Actions CI

Every commit is automatically checked by CI:

View results: [`https://github.com/matt1398/claude-devtools/actions`](https://github.com/matt1398/claude-devtools/actions)

**CI Pipeline includes:**
- TypeScript compilation
- ESLint (with security plugin)
- Unit tests
- Multi-platform builds (Ubuntu, Windows)
- Format validation

### Enable Dependabot (For Forks)

Add `.github/dependabot.yml`:

```yaml
version: 2
updates:
  - package-ecosystem: "npm"
    directory: "/"
    schedule:
      interval: "weekly"
    open-pull-requests-limit: 10
```

### CodeQL Analysis (Advanced)

Enable GitHub's CodeQL scanning:

1. Go to **Settings → Code security and analysis**
2. Enable **CodeQL analysis**
3. Choose language: **JavaScript/TypeScript**
4. Review alerts at `/security/code-scanning`

---

## Manual Code Audit

### 1. Review IPC Handlers

IPC handlers are the bridge between the UI and Node.js. Check for:

```bash
# Find all IPC handlers
grep -r "ipcMain.handle" src/main/
grep -r "ipcMain.on" src/main/
```

**What to look for:**
- Input validation on all parameters
- Path containment checks (no `../` attacks)
- Rejection of sensitive paths (credentials, private keys)
- No `eval()` or `Function()` calls

**Key files:**
- `src/main/index.ts` — Main IPC setup
- `src/preload/index.ts` — Exposed APIs to renderer

### 2. Check for Dangerous Patterns

```bash
# Search for potentially dangerous code
grep -r "eval(" src/
grep -r "Function(" src/
grep -r "exec(" src/
grep -r "execSync(" src/
grep -r "__dirname" src/
grep -r "process.env" src/
```

**Legitimate uses in this codebase:**
- `exec()` / `execSync()` — **NOT USED** (all shell commands are avoided)
- `__dirname` — May appear in build config (electron.vite.config.ts)
- `process.env` — Only for build-time environment variables

### 3. Inspect Dependencies

Check the `dependencies` in `package.json` for unexpected packages:

```bash
# View dependency tree
pnpm list --depth=1

# Check for install scripts (can execute code during install)
pnpm list --json | jq '.[] | select(.scripts.install != null)'
```

**All dependencies should be:**
- Well-known packages (React, Electron, Fastify, etc.)
- Actively maintained
- Have no critical vulnerabilities
- Serve a clear purpose

### 4. Review Network Code

```bash
# Find all network-related code
grep -r "http\." src/
grep -r "https\." src/
grep -r "fetch(" src/
grep -r "XMLHttpRequest" src/
grep -r "WebSocket" src/
```

**Expected network usage:**
- Fastify HTTP server (user-initiated, local only)
- SSH2 client (user-initiated, configured in settings)
- Electron auto-updater (GitHub Releases API, Electron mode only)

### 5. Check for Obfuscated Code

```bash
# Look for minified/obfuscated code in source
find src/ -name "*.js" -o -name "*.ts" | xargs wc -l | sort -n

# Check for extremely long lines (often a sign of minification)
find src/ -type f -exec awk 'length > 500' {} + -print
```

**This codebase:**
- All source code is readable TypeScript
- No minification in `src/` (only in `dist/` after build)
- No Base64-encoded payloads
- No hex-encoded strings

---

## Network Monitoring

### Docker with Network Isolation

For maximum trust, run in Docker with **no network access**:

```bash
docker build -t claude-devtools .
docker run --network none -p 3456:3456 -v ~/.claude:/data/.claude:ro claude-devtools
```

Then access the UI at `http://localhost:3456`.

**Why this works:**
- `--network none` blocks ALL network access
- `-p 3456:3456` still allows localhost connections (port forwarding happens at host level)
- The app can only read local session files
- No external communication is possible

### Verify Zero External Connections

```bash
# macOS/Linux: Start the app, then monitor
sudo tcpdump -i any -n not port 3456 and not host 127.0.0.1

# Should see ONLY GitHub API calls (Electron auto-updater)
# All other traffic should be local (127.0.0.1)
```

**To disable auto-updater** (Electron mode):
- Use standalone mode: `npm run standalone:start`
- Or modify `src/main/index.ts` to skip updater

---

## Additional Resources

### Security Best Practices

- **Principle of Least Privilege**: Run the app as a regular user, not root/admin
- **Read-Only Mounts**: Use `:ro` when mounting volumes in Docker
- **Sandboxing**: Consider running in a VM or container for extra isolation
- **Regular Updates**: Keep dependencies up to date with `pnpm update`
- **Audit Logs**: Review `~/.claude/` for unexpected modifications

### External Tools

| Tool | Purpose | Command |
|------|---------|---------|
| **npm audit** | Dependency vulnerabilities | `pnpm audit` |
| **Snyk** | Dependency & code scanning | `npx snyk test` |
| **OWASP Dependency-Check** | Known CVEs | `dependency-check --scan ./` |
| **Retire.js** | Outdated JS libraries | `npx retire` |
| **Trivy** | Container scanning | `trivy fs .` |
| **Grype** | Vulnerability scanner | `grype dir:.` |

### Reporting Security Issues

If you discover a vulnerability, please report it privately:

1. **DO NOT** open a public GitHub issue
2. See [SECURITY.md](./SECURITY.md) for contact information
3. Include version, description, impact, and reproduction steps

---

## Summary Checklist

Use this checklist to verify the repository is safe:

- [ ] **Clone from official repo** (`matt1398/claude-devtools`)
- [ ] **Run `pnpm audit`** — No critical vulnerabilities
- [ ] **Run `pnpm lint`** — No security warnings
- [ ] **Run `pnpm typecheck`** — No type errors
- [ ] **Run `pnpm build`** — Builds successfully
- [ ] **Check network activity** — Only expected connections (see SECURITY.md)
- [ ] **Check file access** — Only reads from `~/.claude/`
- [ ] **Review IPC handlers** — Input validation present
- [ ] **Inspect dependencies** — All packages are legitimate
- [ ] **Monitor runtime** — No unexpected processes or network calls
- [ ] **Test in Docker with `--network none`** — App still works

If all items pass, the repository is verified as secure.

---

## Questions?

- **Security Policy**: [SECURITY.md](./SECURITY.md)
- **Contributing**: [CONTRIBUTING.md](./CONTRIBUTING.md)
- **Issues**: [GitHub Issues](https://github.com/matt1398/claude-devtools/issues)
- **Discussions**: [GitHub Discussions](https://github.com/matt1398/claude-devtools/discussions)
